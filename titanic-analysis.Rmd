---
title: "Análisis Exploratorio de Datos: Sobrevivientes del Titanic"
author: "Cristopher Acuña Campos
         Jerson Prendas"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    code_folding: hide
params:
  data_path: "tested.csv"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)
library(tidyverse)
library(plotly)
library(ggplot2)
library(ggiraph)
library(cowplot)
```

# Introducción

Este documento presenta un Análisis Exploratorio de Datos (EDA) sobre el conjunto de datos de los sobrevivientes del Titanic. El objetivo es identificar patrones, tendencias y relaciones entre variables para comprender mejor los factores que influyeron en la supervivencia.

# Descripción del Problema

Durante el hundimiento del Titanic en 1912, hubo factores que influyeron en la probabilidad de supervivencia de los pasajeros. Este análisis busca responder preguntas como:

-   ¿Qué variables individuales (edad, sexo, clase) mostraron patrones de supervivencia?
-   ¿Cómo se relaciona el precio del boleto con la supervivencia?
-   ¿Existen interacciones multidimensionales que expliquen grupos de mayor riesgo?

# Definición de Fuentes de Datos

Los datos utilizados provienen de un archivo CSV con la información de los pasajeros del Titanic, que incluye variables como:

-   `Survived`: indicador de supervivencia (0 = No, 1 = Sí)
-   `Pclass`: clase de pasajero (1 = Primera, 2 = Segunda, 3 = Tercera)
-   `Name`, `Sex`, `Age`, `SibSp`, `Parch`, `Ticket`, `Fare`, `Cabin`, `Embarked`

```{r load-data}
# Cargar los datos
datos <- read_csv(params$data_path)
```

# EDA: Gráficas Unidimensionales

Se generan tres gráficas que muestran la distribución de variables con patrones interesantes.

```{r uni-plots}
# 1. Distribución de edad
grafica_edad <- ggplot(datos, aes(x = Age, )) +
  geom_histogram(bins = 30, fill = "#69b3a2", color = "black", size = 0.3) +
  labs(title = "Distribución de Edad", x = "Edad", y = "Frecuencia")
girafe(ggobj = grafica_edad)

# 2. Conteo por sexo
grafica_sex <- ggplot(datos, aes(x = Sex, fill = factor(Sex),
                                 tooltip = paste("Count:", ..count..))) +
  geom_bar_interactive() +
  labs(title = "Conteo de Pasajeros por Sexo", x = "Sexo", y = "Cantidad")
girafe(ggobj = grafica_sex)

# 3. Distribución de tarifa (Fare)
grafica_tarifa <- ggplot(datos, aes(x = Fare)) +
  geom_histogram(bins = 30, fill = "#8dbf8d", color = "black", size = 0.3) +
  labs(title = "Distribución de la Tarifa", x = "Tarifa", y = "Frecuencia")
girafe(ggobj = grafica_tarifa)
```

# EDA: Gráficas Bidimensionales

Se exploran combinaciones de dos variables con posible interrelación.

```{r bi-plots}
# Supervivencia vs Clase y Sexo
p1 <- ggplot(datos, aes(x = Pclass, fill = factor(Survived))) +
  geom_bar(position = "fill") +
  labs(title = "Proporción de Supervivientes por Clase")

# Edad vs Tarifa coloreado por supervivencia
p2 <- ggplot(datos, aes(x = Age, y = Fare, color = factor(Survived))) +
  geom_point(alpha = 0.6) +
  labs(title = "Edad vs Tarifa según Supervivencia")

subplot(ggplotly(p1), ggplotly(p2), nrows = 2)
```

# EDA: Gráfica Multidimensional

Se incorpora al menos una gráfica con cinco variables simultáneas.

```{r multi-plot}
plot_ly(datos, x = ~Age, y = ~Fare, color = ~factor(Pclass), symbol = ~factor(Sex), size = ~SibSp,
        text = ~paste("Sobrevivió:", Survived)) %>%
  layout(title = "Multidimensional: Edad, Tarifa, Clase, Sexo, SibSp")
```

# Facetas

```{r facetas}
# Faceta por Embarque y Sexo mostrando edad vs tarifa
grafica_faceta_edad_vs_tarifa <- ggplot(datos, aes(x = Age, y = Fare)) +
  geom_point(alpha = 0.5) +
  facet_grid(Embarked ~ Sex) +
  labs(title = "Edad vs Tarifa por Embarque y Sexo", x = "Edad", y = "Tarifa")
girafe(ggobj = grafica_faceta_edad_vs_tarifa)
```

# Imagen Compuesta

```{r composite-plot}
# Composición con tres gráficos: tarifa, edad y clase
plot_grid(
  ggplot(datos, aes(x = Fare)) + geom_histogram(bins = 30),
  ggplot(datos, aes(x = Age)) + geom_histogram(bins = 30),
  ggplot(datos, aes(x = factor(Pclass), fill = factor(Survived))) + geom_bar(),
  ncol = 1,
  labels = c("Tarifa", "Edad", "Supervivencia por Clase")
)


# Gráfico 1: Supervivencia por Clase
df_class <- datos %>%
  group_by(Pclass, Survived) %>%
  summarise(Count = n()) %>%
  ungroup()

fig1 <- plot_ly(df_class, x = ~as.factor(Pclass), y = ~Count, color = ~as.factor(Survived),
                type = "bar") %>%
  layout(title = "Supervivencia por Clase",
         xaxis = list(title = "Clase"),
         yaxis = list(title = "Cantidad"),
         barmode = "group")

# Gráfico 2: Distribución de Edad por Supervivencia
fig2 <- plot_ly(datos, x = ~Age, color = ~as.factor(Survived),
                type = "histogram", nbinsx = 30, opacity = 0.6) %>%
  layout(title = "Distribución de Edad por Supervivencia",
         xaxis = list(title = "Edad"),
         yaxis = list(title = "Frecuencia"),
         barmode = "overlay")

# Gráfico 3: Supervivencia por Puerto de Embarque
df_port <- datos %>%
  group_by(Embarked, Survived) %>%
  summarise(Count = n()) %>%
  ungroup()

fig3 <- plot_ly(df_port, x = ~Embarked, y = ~Count, color = ~as.factor(Survived),
                type = "bar") %>%
  layout(title = "Supervivencia por Puerto de Embarque",
         xaxis = list(title = "Puerto"),
         yaxis = list(title = "Cantidad"),
         barmode = "group")

# Composición de los tres gráficos en una fila
subplot(fig1, fig2, fig3, nrows = 3, shareY = FALSE, titleX = TRUE, titleY = TRUE) %>%
  layout(title = "Análisis Compuesto de Supervivencia - Titanic")
```

# Conclusiones

En esta sección se describen las conclusiones principales, reflejando los hallazgos más relevantes del análisis.
