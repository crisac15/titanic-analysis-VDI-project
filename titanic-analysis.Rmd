---
title: "Análisis Exploratorio de Datos: Sobrevivientes del Titanic"
author: "Cristopher Acuña Campos
         Jerson Prendas"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    code_folding: hide
params:
  data_path: "tested.csv"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)
library(tidyverse)
library(plotly)
library(ggiraph)
library(cowplot)
```

# Introducción

En este análisis combinamos la potencia de R con un enfoque de storytelling para responder una pregunta tan intrigante como relevante: ¿Quiénes tuvieron más probabilidades de sobrevivir al hundimiento del Titanic en 1912 y por qué?. A través de una cuidadosa mezcla de texto explicativo, visualizaciones interactivas y fragmentos de código, guiaremos al lector paso a paso por el proceso de exploración de datos, asegurándonos de que cada gráfica y cada transformación refuercen la narrativa central.

# Contexto Histórico y Pregunta Central

En la madrugada del 15 de abril de 1912, el lujoso transatlántico Titanic se hundió tras chocar contra un iceberg en el Atlántico Norte. De los 2 224 pasajeros que viajaban en sus diversas cubiertas, tan solo unos pocos lograron salvarse. Este trágico suceso no solo marcó un hito en la historia naval, sino que dejó un legado de preguntas sobre cómo factores sociales y económicos determinaron quién tenía acceso a los botes salvavidas.

Nuestro objetivo en este informe no es solo reproducir cifras, sino entender la historia que cuentan los datos. Queremos responder a la gran pregunta:

¿Qué combinaciones de clase social, género, edad, precio del boleto y puerto de embarque estuvieron asociadas con mayores probabilidades de supervivencia?

Para guiar este recorrido, planteamos tres hipótesis iniciales:

-   Clase social: los pasajeros de primera clase tuvieron mejores tasas de supervivencia que los de segunda y tercera.

-   Género: las mujeres —y particularmente las mujeres acompañadas de niños— fueron favorecidas en los procedimientos de evacuación.

-   Edad y tarifa: los niños y quienes pagaron tarifas más altas disfrutaron de una ventaja, tanto por protocolos de rescate como por ubicar sus camarotes más cerca de las cubiertas superiores.

A lo largo del análisis exploraremos estas hipótesis mediante una serie de visualizaciones que mostrarán, de manera unidimensional, bidimensional y multidimensional, cómo cada factor individual y sus interacciones influyeron en el desenlace de esta tragedia.

# Descripción de los Datos

En esta sección presentamos de forma clara la naturaleza y alcance del conjunto de datos que sustenta nuestro análisis. El archivo tested.csv contiene registros de 891 pasajeros del Titanic, con variables demográficas, socioeconómicas y de embarque. Comprender su estructura y calidad es clave para interpretar correctamente las visualizaciones que veremos más adelante.

¿Qué encontramos al inspeccionar estos datos?

-   Survived: indicador binario de supervivencia (0 = no, 1 = sí).

-   Pclass: clase del pasaje (1 = Primera, 2 = Segunda, 3 = Tercera).

-   Name, Sex, Age: información personal del pasajero.

-   SibSp, Parch: número de hermanos/cónyuges o padres/hijos a bordo.

-   Ticket, Fare, Cabin: detalles del billete, precio pagado y cabina asignada.

-   Embarked: puerto de embarque (C = Cherburgo, Q = Queenstown, S = Southampton).

Para asegurar la fiabilidad de nuestro estudio, evaluaremos también el porcentaje de valores faltantes en variables críticas:

-   Edad (Age): aproximadamente 20 % de los registros sin datos.

-   Cabina (Cabin): más del 70 % ausente, por lo que lo usaremos con cautela.

-   Puerto de embarque (Embarked): solo unos pocos valores faltantes.

Es ***importante*** ***aclarar*** que la falta de algunos valores podrían afectar la visualizacion estadística de los datos, por lo cual cados como "Cabina" que presentan solo un 30% de informacion, podrían no ser tan importantes de cara a evidenciar relaciones entre las variables.

```{r load-data}
# Cargar los datos
 datos <- read_csv(params$data_path)
```

# EDA Unidimensional

Una vez cargados los datos en bruto, el primer paso es explorar cada variable de forma individual para entender su distribución y detectar posibles sesgos o valores atípicos. A continuación presentamos tres visualizaciones que nos ayudan a “conocer” mejor a los pasajeros antes de cruzar información entre variables.

### Distribución de Edad

La edad de los pasajeros muestra un amplio rango, desde recién nacidos hasta ancianos. Al graficar un histograma con 30 intervalos, podremos identificar si existen concentraciones en determinados grupos etarios (por ejemplo, presencia de muchos niños pequeños o predominio de adultos jóvenes). Esta visión inicial es fundamental para decidir si, más adelante, es necesario imputar valores faltantes o agrupar la variable en categorías (niños, adultos, ancianos).

```{r uni-plots}
# 1. Distribución de Edad
g1 <- ggplot(datos, aes(x = Age)) +
  geom_histogram(bins = 30, fill = "#69b3a2", color = "black", na.rm = TRUE) +
  labs(title = "Distribución de Edad", x = "Edad (años)", y = "Frecuencia") +
  theme_minimal()

girafe(ggobj = g1, width_svg = 7, height_svg = 4)
```

> El histograma de edades nos muestra que la mayoría de la gente a bordo del Titanic tenía entre 20 y 30 años: casi 4 de cada 10 pasajeros. Eso significa que, cuando miremos quién sobrevivió o no, gran parte de la historia vendrá de ese grupo de “veintitantos”.  
Los niños y adolescentes (de 0 a 20 años) son menos de uno de cada cinco pasajeros. Aunque “mujeres y niños primero” suene fuerte, su pequeñísimo número hace que, en el total, su influencia sea secundaria. Habrá que ver su tasa de rescate, pero sin olvidar que son pocos casos.  
A partir de los 30 años la cantidad de pasajeros baja sin parar: de un 20 % en los treintañeros a un 6 % en los de 50–60, y casi nadie pasa de los 60. Ese goteo de mayores indica que cualquier conclusión sobre ancianos será inestable, porque casi no hay datos de ellos.

### Conteo por Sexo

El género es un factor crítico para entender las decisiones de evacuación. Un gráfico de barras nos mostrará la proporción de hombres y mujeres abordo, sin mezclarlos aún con la supervivencia. Con este conteo simple confirmamos si existe un desequilibrio de género en la muestra, lo cual podría sesgar las tasas de supervivencia si, por ejemplo, hubiera muchos más hombres que mujeres.

```{r uni-plots2}
# 2. Conteo por Sexo
g2 <- ggplot(datos, aes(x = Sex, fill = Sex)) +
  geom_bar(width = 0.6, na.rm = TRUE) +
  labs(title = "Cantidad de Pasajeros por Sexo", x = "Sexo", y = "Cantidad") +
  theme_minimal()

girafe(ggobj = g2, width_svg = 5, height_svg = 4)
```

> Hay 266 pasajeros hombres y 152 mujeres, es decir, los varones representan alrededor del 64 % de la muestra y las mujeres el 36 %. Este desequilibrio es nítido: por cada mujer hay casi dos hombres a bordo.  
Dado que un sexo es mayoría y el otro minoría, cualquier análisis posterior que involucre “Sex” debe basarse en porcentajes o tasas, no en conteos absolutos, para que la comparación sea justa y no esté sesgada por el simple hecho de que hay más hombres que mujeres.

### Distribución de Tarifas

El precio del boleto (`Fare`) es otra dimensión unidimensional clave. Al graficar un histograma con 30 “bins”, observaremos la dispersión de tarifas, desde los boletos más económicos hasta los de lujo extremo. Una distribución muy sesgada hacia valores bajos, con colas largas de valores altos, indicaría la necesidad de usar escalas logarítmicas o agrupar tarifas en rangos para facilitar la interpretación.

```{r uni-plots3}
# 3. Distribución de Tarifas
g3 <- ggplot(datos, aes(x = Fare)) +
  geom_histogram(bins = 35, fill = "#8dbf8d", color = "black", na.rm = TRUE) +
  labs(title = "Distribución de la Tarifa", x = "Tarifa (USD)", y = "Frecuencia") +
  theme_minimal()

girafe(ggobj = g3, width_svg = 7, height_svg = 4)
```

> La gran mayoría de los pasajeros pagó montos bajos: cerca del 80 % pagó menos de 50 USD por su pasaje. Esa concentración en tarifas crea un énfasis bien definido a la izquierda del gráfico, donde se amontonan los boletos de costo bajo  
Además, la curva se extiende con una larga cola hacia la derecha: hay unos cuantos pasajeros que pagaron centenares de dólares, y el máximo registrado llega a aproximadamente 500 USD. Esos picos aislados de tarifa alta representan a los viajeros de primera clase, pero son muy pocos.

## EDA Bidimensional

Para profundizar en cómo interactúan dos variables clave con la supervivencia, presentamos a continuación dos visualizaciones que combinan información de clase, edad, tarifa y resultado (sobrevivió o no). Estas gráficas bidimensionales nos permiten ver, de un vistazo, patrones que no aparecen al analizar cada variable aisladamente.

### Proporción de Supervivientes por Clase

Este gráfico de barras apiladas y normalizadas muestra la **proporción** de pasajeros que sobrevivieron en cada una de las tres clases sociales.

```{r bi-plots}
# Proporción de Supervivientes por Clase
gg1 <- ggplot(datos, aes(x = factor(Pclass), fill = factor(Survived))) +
  geom_bar(position = "fill", na.rm = TRUE) +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Proporción de Supervivientes por Clase", x = "Clase", y = "Proporción", fill = "Sobrevivió") +
  theme_minimal()
ggplotly(gg1)
```

> Casi la mitad de quienes viajaban en primera lograron salvarse, frente a poco más de un tercio en las otras dos clases. Eso refuerza la idea de que el acceso a los botes estaba muy favorecido para los de tarifa alta.
Aunque la tercera clase suele considerarse la más desfavorecida, aquí vemos que su tasa de supervivencia es prácticamente igual a la de la segunda. La barra de primera clase está mucho más “balanceada” que las de segunda y tercera. Eso implica que, aunque viajar en primera no garantizaba la salvación, sí doblaba la probabilidad de sobrevivir en comparación con las clases económicas.

### Edad vs Tarifa según Supervivencia

En esta nube de puntos coloreada por supervivencia, cruzamos **edad** (eje X) y **tarifa pagada** (eje Y), para ver si hay una tendencia conjunta entre quién pagó más y quién era más joven.

```{r bi-plots2}
# Edad vs Tarifa según Supervivencia
gg2 <- ggplot(datos, aes(x = Age, y = Fare, color = factor(Survived))) +
  geom_point(alpha = 0.6, na.rm = TRUE) +
  labs(title = "Edad vs Tarifa según Supervivencia", x = "Edad (años)", y = "Tarifa (USD)", color = "Sobrevivió") +
  theme_minimal()
ggplotly(gg2)
```

> No hay un rango de edad privilegiado a la hora de salvarse, pues puntos verdes (los que sobrevivieron) y rojos (los que no) se mezclan a lo largo de todo el eje vertical de la edad. En cambio, el eje de la tarifa funciona como una línea de bastante importancia: casi todos los que pagaron menos de 20 USD aproximadamente aparecen en rojo, mientras que los verdes se concentran en la zona de tarifas medias y altas. Esto nos dice que, más que la edad, lo que realmente marcó la diferencia fue el precio del pasaje.

Para profundizar aún más, combinamos la categoría de **grupo etario** (“Niños”, “Adultos”, “Adultos mayores”) con la **clase de pasaje** (1ª, 2ª, 3ª) y el **resultado de supervivencia**.

```{r age-group-by-class}
# 1. Definir grupos de edad
datos <- datos %>%
  mutate(
    age_group = case_when(
      Age < 18              ~ "Niños",
      Age >= 18 & Age <= 60 ~ "Adultos",
      Age > 60              ~ "Adultos mayores",
      TRUE                  ~ NA_character_
    ),
    age_group = factor(age_group, levels = c("Niños","Adultos","Adultos mayores"))
  )

# 2. Preparar conteos por clase y supervivencia
age_class_surv <- datos %>%
  filter(!is.na(age_group)) %>%
  count(Pclass, age_group, Survived) %>%
  group_by(Pclass, age_group) %>%
  mutate(pct = n / sum(n))

# 3. Plot bidimensional
g_age_class <- ggplot(age_class_surv,
                      aes(x = age_group, y = pct, fill = factor(Survived))) +
  geom_col(position = "dodge") +
  facet_wrap(~ Pclass, nrow = 1, labeller = labeller(Pclass = c("1"="1ª Clase","2"="2ª Clase","3"="3ª Clase"))) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(
    title    = "Supervivencia por Grupo de Edad y Clase",
    x        = "Grupo de Edad",
    y        = "Porcentaje dentro de cada clase",
    fill     = "Sobrevivió"
  ) +
  theme_minimal()

girafe(ggobj = g_age_class, width_svg = 9, height_svg = 5)
```

> ### Primera clase (1ª Clase)  
 -   Niños: sorprendentemente, ninguno de los niños que viajaba en primera clase sobrevivió (100 % fallecidos).  
 -   Adultos: la supervivencia fue pareja, con un 50 % de los adultos salvados y un 50 % que no lo logró.  
 -   Adultos mayores: más de la mitad salió con vida, frente a un casi 40 % que no sobrevivió.  
Aquí, la ventaja de estar en primera clase benefició especialmente a los pasajeros de más edad, mientras que los niños tuvieron el peor desenlace.

> ### Segunda clase (2ª Clase)
 - Niños: este pequeño grupo disfrutó de un buen rescate: el 60 % de los niños de segunda clase sobrevivió.
 - Adultos: solo el 30 % aproximadamente de los adultos salió con vida; el restante quedó detrás.
 - Adultos mayores: ninguno de los pasajeros mayores de 60 años en segunda clase logró sobrevivir (100 % fallecidos).  
En segunda clase la prioridad a “mujeres y niños” funcionó para los más jóvenes, pero no para los ancianos.

> ### Tercera clase (3ª Clase)
 - Niños: alrededor del 39 % de los niños de tercera clase sobrevivió, mientras que el 61 % no.
 - Adultos: un tercio (33.3 %) de los adultos vivió, y dos tercios (66.7 %) murieron.
 - Adultos mayores: al igual que en segunda clase, ningún mayor de 60 años en tercera clase sobrevivió.  
En tercera clase la supervivencia fue baja en todos los grupos, ligeramente mejor para los niños, pero sin salvar a ningún anciano.

## EDA Multidimensional: Bubble Chart

Más allá de dos variables, el gráfico de burbujas añade un tercer y cuarto componente: el **tamaño** de la burbuja representa la clase (`Pclass`) y el **color** indica supervivencia. Esto nos permite identificar “clusters” de pasajeros con características similares.

```{r bubble-chart}
library(ggplot2)

# Filtrar datos y preparar la información
bubble_data <- datos %>%
  filter(!is.na(Age), !is.na(Fare), !is.na(Survived)) %>%
  mutate(Survived = factor(Survived, labels = c("No", "Sí")))

# Crear el gráfico de burbujas
grafico_burbujas <- ggplot(bubble_data, aes(x = Age, y = Fare, size = Pclass, color = Survived)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Relación entre Edad, Tarifa, Clase y Supervivencia",
    x = "Edad",
    y = "Tarifa",
    size = "Clase",
    color = "Sobrevivió"
  ) +
  theme_minimal()

girafe(ggobj = grafico_burbujas)

```

> Al observar las burbujas grandes (primera clase), vemos que casi todas en la zona de tarifas altas (por encima de 100 USD) son de color “Sí”: los pasajeros de primera que pagaron más tuvieron altas probabilidades de sobrevivir, sin importar la edad. Las burbujas grandes y rojas (“No”) aparecen solo cuando la tarifa es baja o moderada, mostrando que incluso un viajero de primera clase corría peligro si su pasaje no fue de los más caros.  
En las burbujas de tamaño mediano (segunda clase), el color está más mezclado: hay algunos “Sí” en tarifas alrededor de 50 USD, pero muchas burbujas rojas se extienden desde precios bajos hasta medios. Aquí la edad tampoco define el color: tanto jóvenes como adultos de mediana edad mueren o sobreviven dependiendo más de cuánto pagaron que de cuántos años tenían.  
Las burbujas pequeñas (tercera clase) están casi todas en rojo, especialmente en tarifas bajas (menores de 20 USD). Solo unas pocas tardías suben un poco en el eje y y cambian a verde, y suelen corresponder a adultos jóvenes. Los ancianos de tercera clase (pequeñas burbujas en la parte derecha del eje x) permanecen rojos, incluso si la tarifa es algo mayor.

## Facetas: Puertos de Embarque y Sexo

Para estudiar cómo interactúan tres variables al mismo tiempo, usamos **facetas** que organizan la nube de puntos Edad vs Tarifa según el puerto de embarque (filas) y el sexo (columnas). Con `scales = "free"`, cada panel ajusta sus ejes de forma independiente para resaltar las variaciones locales.

```{r facetas}
grafica_faceta <- ggplot(datos, aes(x = Age, y = Fare)) +
  geom_point(alpha = 0.5, na.rm = TRUE) +
  facet_wrap(Embarked ~ Sex, scales = "free", ncol = 2) +
  labs(title = "Edad vs Tarifa por Puerto de Embarque y Sexo", x = "Edad (años)", y = "Tarifa (USD)") +
  theme_minimal() +
  theme(strip.text = element_text(size = 10), axis.text = element_text(size = 8))

girafe(ggobj = grafica_faceta, width_svg = 8, height_svg = 5)
```

> ### Cherburgo (C)  
Las pasajeras de Cherburgo exhiben las tarifas más altas de todo el conjunto de datos, con varios boletos que superan los 200 USD (alcanzando incluso 500 USD). Los hombres que embarcaron en C pagan también más que en otros puertos. En cuanto a la edad, las mujeres en C promedian alrededor de 36 años, mientras que los hombres se sitúan cerca de los 31 años, y ambos sexos muestran un rango amplio de edades.

> ### Queenstown (Q)  
Tanto mujeres como hombres de Queenstown pagan tarifas muy homogéneas, concentradas alrededor de los 7 USD.Se trata de un grupo de pasajeros con recursos limitados. Las edades se extienden desde la adolescencia hasta los cuarenta años, sin diferencias notables entre géneros.

> ### Southampton (S)  
Southampton representa un punto intermedio: las mujeres pagan alrededor de 20 USD y los hombres unos 10 USD, con la mayoría de los boletos en el rango de 7 USD a 40 USD. Hay algunos casos aislados de pasajes caros (hasta 200 USD), pero son minoría. La distribución de edades es similar para ambos sexos, con una aproximado alrededor de 25 años.

## Imagen Compuesta Interactiva

Para cerrar el análisis con un resumen visual poderoso, combinamos tres gráficos interactivos en un solo lienzo mediante `subplot` de **plotly**. Cada panel aporta una dimensión distinta al storytelling:

1.  **FigA**: Porcentaje de supervivientes por sexo (barras apiladas).\
2.  **FigB**: Densidad de tarifas por supervivencia (histograma normalizado).\
3.  **FigC**: Diagrama de pastel de supervivencia por grupo de edad (“Niños”, “Adultos”, “Adultos mayores”).

```{r imagen-compuesta-interactiva, echo=FALSE, message=FALSE}
# Gráfico A: Porcentaje de Supervivientes por Sexo (barra apilada)
figA <- plot_ly(datos %>% count(Sex, Survived) %>% mutate(pct = n / sum(n)),
               x = ~Sex, y = ~pct, color = ~factor(Survived), type = 'bar') %>%
  layout(barmode = 'stack',
         title = 'Porcentaje de Supervivientes por Sexo',
         xaxis = list(title = 'Sexo'),
         yaxis = list(title = 'Proporción', tickformat = '%'),
         legend = list(title = list(text = 'Supervivió')))

# Gráfico B: Violin de Edad por Supervivencia
grid_df <- datos %>% filter(!is.na(Age))
figB <- plot_ly(grid_df, x = ~factor(Survived), y = ~Age, color = ~factor(Survived), type = 'violin', box = list(visible = TRUE), meanline = list(visible = TRUE)) %>%
  layout(title = 'Distribución de Edad por Supervivencia',
         xaxis = list(title = 'Supervivió'),
         yaxis = list(title = 'Edad (años)'),
         legend = list(title = list(text = 'Supervivió')))

# Gráfico C: Densidad de Tarifas
grid_df2 <- datos %>% filter(!is.na(Fare))
figC <- plot_ly(grid_df2, x = ~Fare, color = ~factor(Survived), type = 'histogram', histnorm = 'density', opacity = 0.6) %>%
  layout(barmode = 'overlay',
         title = 'Densidad de Tarifas por Supervivencia',
         xaxis = list(title = 'Tarifa (USD)'),
         yaxis = list(title = 'Densidad'),
         legend = list(title = list(text = 'Supervivió')))

# Combinar los tres gráficos interactivos
subplot(figA, figB, figC, nrows = 3, shareX = FALSE, shareY = FALSE, titleX = TRUE, titleY = TRUE)
```

> -   FigA destaca la desigualdad de género en el acceso a botes.\
> -   FigB revela si los niños o ancianos recibieron prioridad.\
> -   FigC muestra la correlación entre tarifas altas y tasas de rescate.

# Conclusiones
